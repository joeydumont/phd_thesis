% --------------------------------------------------------------------------- %
% Author:          Joey Dumont                <joey.dumont@gmail.com>         %
% Date created:    Mar. 8th, 2017                                             %
% Description:     Ph. D. thesis file.                                        %
% License:         CC0                                                        %
%                  <https://creativecommons.org/publicdomain/zero/1.0>        %
% --------------------------------------------------------------------------- %

% --------------------------------------------------------------------------- %
% --                               Preamble                                -- %
% --------------------------------------------------------------------------- %

% ----------------------------------------------------------------- %
% --                       Document Class                        -- %
% ----------------------------------------------------------------- %

\documentclass[11pt,SymmetricalJury]{inrsthesis/inrsthesis}

% ----------------------------------------------------------------- %
% --                          Packages                           -- %
% ----------------------------------------------------------------- %

\let\mathfrak\undefined
\usepackage[charter]{mathdesign}
\usepackage[scaled=.96]{XCharter}

\usepackage[showframe,pass]{geometry} % Shows the frame properly when using memoir.
\usepackage{amsmath}
\usepackage[theorems=false]{latex-tools/vphys}        % Common LaTeX tools that I use.
\usepackage{todonotes}

\usepackage[unicode=true,
      pdfauthor={Joey Dumont},
      pdftitle={},
      bookmarks=true,
      bookmarksnumbered=true,
      bookmarksopen=true,
      bookmarksopenlevel=3,
      breaklinks=false,
      pdfborder={0 0 0},
      backref=false,
      colorlinks=true,
      linktoc=page,
      linkcolor=red,
      citecolor=blue,
      urlcolor=blue]
 {hyperref}

% ----------------------------------------------------------------- %
% --                        Customization                        -- %
% ----------------------------------------------------------------- %
\newenvironment{chaptersummary}{%
  \begin{quotation}
  \SingleSpacing
  \setlength{\parskip}{\baselineskip}}{%
  \end{quotation}}

\allowdisplaybreaks

% ----------------------------------------------------------------- %
% --                       Title Page Info                       -- %
% ----------------------------------------------------------------- %
\title{Strong-field quantum electrodynamics \\ in tightly focused fields}
%\subtitle{Towards a Realitnatbibic Modelling of High-Power \\Laser Systems in the Quantum Theory}
\author{Joey Dumont}
\year{2018}
\program{Sciences de l'énergie et des matériaux}
\centreINRS{Centre Énergie Matériaux et Télécommunications}
\jury{
  \juryitem
    {Président du jury et \\ examinateur interne}
    {Nom du professeur \\ Institution}
  \\
  \juryitem
    {Examinateur externe}
    {Nom du professeur \\ Faculté ou département \\ Institution}
  \\
  \juryitem
    {Examinateur interne}
    {Nom du professeur \\ Institution}
  \\
  \juryitem
    {Directeur de recherche}
    {Jean-Claude Kieffer \\ INRS-ÉMT}
  \\
  \juryitem
    {Codirecteur de recherche}
    {Steve MacLean \\ INRS-ÉMT \\ University of Waterloo}
}
% --------------------------------------------------------------------------- %
% --                               Document                                -- %
% --------------------------------------------------------------------------- %

\begin{document}

\frontmatter

\maketitle

\chapter{Résumé}

Mots-clés:

\chapter{Abstract}

Keyword:

\chapter{Sommaire récapitulatif}
\cleardoublepage

\tableofcontents
\cleardoublepage

\listoftables
\cleardoublepage

\listoffigures
\cleardoublepage

% \dedication{To my wife and son.}
% \cleardoublepage

\epigraph{More important, the formulation in terms of a variational principle is the route
          that is generally followed when we try to describe apparently nonmechanical systems
          in the mathematical clothes of classical mechanics, as in the theory of fields.}{Goldstein \textit{et al}, Classical Mechanics, 3rd edition.}
\cleardoublepage

\epigraph{Whatever you do, do the best you can. The film lives forever!}{Jackie Chan}

\begin{flushright}
\begin{minipage}{0.35\textwidth}
The author claims that this statement not only applies for films with badass
action sequences, but for every artistic, cultural or scientific endeavour.
\end{minipage}
\end{flushright}

\cleardoublepage
\mainmatter

\chapter{Introduction}

Basic plan:
  \begin{itemize}
    \item Generic introduction to SF-QED, experiments by SLAC and the upcoming
          high power-laser facilities.
    \item Motivation to accurately model the tight focusing regime: field inhomogeneities
          play an important role in the detection of SF-QED observables (cite recent work by Di Piazza).
    \item Approach based on two steps: modelling the optical side of things, then the quantum side of things.
    \item Motivation behind the StrattoCalculator (vs Richards-Wolf, vs analytical solutions).
    \item Motivation behind SK (vs effective methods, vs analytical solutions). BONUS: inclusive observables.
    \item Discussion of the use of HPC resources as a driver of future SF-QED experiments?
  \end{itemize}

Stuff to put in appendices:
  \begin{enumerate}
    \item Details of the Stratton-Chu formalism, perhaps some stuff on
          discontinuity ``problem'' \cite{Asvestas1980} and the heuristic argument as to why
          the physical approximation is correct.
    \item Expressions of identity operators in Fock space for photons and fermions.
    \item Proof that disconnected vacuum diagrams vanish identically in the SK formalism.
    \item Minor results related to the \texttt{StrattoCalculator}:
      \begin{itemize}
        \item Gouy phase and its transverse momentum interpretation.
        \item Work on the generation of pseudo-radially polarized beams with mosaics of half-wave plates?
      \end{itemize}
  \end{enumerate}

\chapter{Tool 1: The Stratton-Chu Diffraction Integrals}
\label{chapter:stratton-chu}

\begin{chaptersummary}
This chapter discusses the problem of properly modelling electromagnetic fields
in the tight focusing regime. We first lay the foundation of electromagnetic
scattering and justify the choice of the Stratton-Chu formalism. Our numerical
implementation of this formalism is then discussed at length, and our results
are benchmarked against analytical results and results from the literature.
We briefly discuss the Richards-Wolf formalism, which is similar but not equivalent
to the Stratton-Chu formulation.
\end{chaptersummary}

The observation of strong-field quantum electrodynamics (SF-QED) processes with light
is contingent, for the most part, on the development of high-intensity laser sources \cite{DiPiazza}. Achieving
these high intensities can be achieved either by (1) increasing the pump energy,
(2) shortening the pulse duration or (3) concentrating the beam in a small volume of space.
While recent laser systems have made significant advances on the first two items, there seems
to be technological difficulties in engineering gratings resistant enough to withstand the extreme
energy of the laser pulse.

A promising avenue is the focusing of light down to extremely small volumes, on the order
of the wavelength of the radiation. In this regime, however, the oft used paraxial approximation
does not hold. This approximation can be related to a Taylor expansion in terms
of the $\epsilon=\lambda/\pi w_0$ \cite{LAX}, which diverges for tightly focused
fields \cite{10.1364/OL.28.000774}.

To see this, simply compare the fields of a ``focused'' paraxial beam with that
of a fully numerical solution of Maxwell's equations (more on that later).
\todo{Add figures of the fields seperately, then show the overlap integral
for each. Comment on it.} Even with added terms \todo{Same thing again.}

There also exists analytical solutionso f Maxwell's equations that do not rely
on the paraxial approximation, such as e-dipole pulses and other models
\cite{Gonoskov,Salamin}. They can be incredibly useful when used as part of
numerically-heavy codes, such as particle-in-cell codes because of their low
cost of evaluation. However, as any solution of Maxwell's equations in vacuum,
they do not take into account the minutiae of a given experimental setup
and thus fail to reproduce some details of tightly focused fields.
\todo{Argue why this is important.}

In this chapter, we introduce a fully numerical implementation of the Stratton-Chu
equations used to model the spatio-temporal focusing properties of large
bandwidth laser pulses focused by high numerical aperture optics. First, we
provide a detailed review of the Stratton-Chu integral representation and discuss
their reduction to a set of diffraction integrals. \todo{Finish division paragraph.}

\section{Derivation of the Stratton-Chu Diffraction Integrals}

The theoretical setup is as follows. Electric and magnetic currents\footnote{Magnetic
currents are used as a stand-in for an incident electric field \cite{Scheluchoff}.}
whose support are $V_e$ and $V_m$, respectively, are supposed to exist in free
space, denoted by $V_\infty$ (Fig.~\ref{fig:sc.scatteringSystem})

The starting point is, as usual, the Maxwell equations. Their macroscopic version,
in Lorentz-Heaviside units with $c=1$, read
  \begin{align}
    \nabla\times\vb{E} &= -\frac{\partial\vb{B}}{\partial t} \\
    \nabla\times\vb{H} &=  \frac{\partial\vb{D}}{\partial t} + \vb{J_e}
  \end{align}
where $\vb{E}$ is the electric field, $\vb{B}$ is the magnetic field,
$\vb{D}$ the electric displacement, and $\vb{H}$ the magnetic field strength.
$\vb{J}_e$ is an electric current distribution that generates

  \begin{figure}
    \label{fig:sc.scatteringSystem}
    \centering
    \includegraphics{figs/scatteringSystem.pdf}
    \caption[Geometry used in the derivation of the Stratton-Chu equations.]
            {Geometry used in the derivation of the Stratton-Chu equations.
             $V_s$ contains the scattering object, while $V_e$ and $V_m$ are the
             support of the electric and magnetic current distribution fonctions.
             $V_\infty$ represents free space, minus the scatterer, i.e.
             $V_\infty=\mathbb{R}^3\backslash V_s$.}
  \end{figure}

\begin{comment}

IDEAS:
  \begin{itemize}
    \item Example of laser chain diagram with regime of validity of paraxial approximation.
    \item HNA parabolic mirror as counterexample in the laser chain, and danger of
            sending the laser back into itself through secondary reflections.
    \item Overlap of "focused" Gaussian beam with StrattoCalculator result.
    \item Overlap of other field models with StrattoCalculator.
  \end{itemize}

Skeleton:
  \begin{itemize}
      \item Short derivation of the Stratton-Chu equations, with emphasis on the physical optics approximation.
      \item Numerical implementation of the method
        \begin{itemize}
            \item Pros/cons vs more popular methods.
            \item Details of the field calculation (field models, normalization and whatnot).
            \item Details of the MPI implementation.
            \item Phase cancellation in the focal spot.
            \item Appendix: Numerical checks like convergence, solution of Maxwell's equations.
            \item Appendix: Far-field of the SC equations.
            \item Appendix: Analysis of the Gouy phase and its transverse momentum interpretation.
        \end{itemize}
      \item Comparison with Richards-Wolf:
        \begin{itemize}
            \item No ``real'' derivation from SC to RW without implicit approximations.
            \item Problem with phase cancellation?
            \item Differing results in similar conditions.
        \end{itemize}
      \item Analysis of the fields in the focal spot and comparison with
            existing analytical solutions (Salamin, e-dipoles).
      \item Opening to other methods that are less computationnaly intensive;
        \begin{itemize}
            \item Transformation optics;
            \item Propagation equations?
        \end{itemize}
  \end{itemize}

\end{comment}

\chapter{Application I: Four-Wave Mixing \textit{in vacuo} and Pair Production}

Skeleton:
\begin{itemize}
    \item Simple derivation of the EH Lagrangian.
    \item How to extract FWM from EH: linearisation + integral solution (WaveMixer)
    \item How to extract PP from EH: Adiabatic formula.
    \item MASTER TABLE, or how different field models affect FWM.
      \begin{itemize}
        \item Introduction of the different field models.
        \item Introduction of the transmission parabola.
        \item Explain the behaviour of yield as a function of 2f/rmax with Lorentz invariants,
              i.e. the optics of the experiment.
      \end{itemize}
    \item Pair production, w/ linear and radial beams.
      \begin{itemize}
          \item Show that both polarizations show the same behaviour as a function of f.
          \item Visualize the 3D fields and explain optimum in terms of the optics (cancellation of the
                magnetic field in both cases).
      \end{itemize}
\end{itemize}

\chapter{Application II: Radiation Reaction With High Energy Electrons}

Skeleton (still a rough idea):
  \begin{itemize}
    \item Quantify RR in different field configurations, checking whether there
          is an advantage to using a transmission parabola in this case.
    \item Study the effects of different field models on the detectability of
          RR effects.
    \item Mention intensity measurement stuff? I've worked a little on this\ldots
  \end{itemize}

\chapter{Tool 2: The Schwinger-Keldysh Formalism and SF-QED Observables}

% On the mathematical nonexistence of path integrals.
%Goldstein, 3rd ed. p. 36
\epigraph{The emperor has no clothes.}{Yours truly}


Skeleton (early stages):
  \begin{itemize}
      \item Motivation of SK: single+double Compton scattering in Furry picture,
            difficulty of going above double/including the effects of arbitrary fields.
      \item Generalities of the SK formalism (definitions and formal results).
      \item Application to SF-QED: computing inclusive observables in
            arbitrary fields (proof-of-concept derivation following Gelis).
      \item Discuss the generality of the method: compatibility with
            Volkov solns, with the Di Piazza method, \textit{and} with numerical
            solutions of the Dirac equation.
      \item Appendix: Disconnected vacuum diagrams vanish in SK.
      \item Appendix: Proper derivation of the Volkov-SK propagators.
  \end{itemize}


\chapter{Application III: Photon Production via Compton Scattering}

Work to be done:
  \begin{itemize}
      \item Formal derivation of the average number of photons with an electron
            in the initial state.
      \item Computation with Volkov propagators.
      \item Computation with Di Piazza solution.
      \item Opening to numerical solutions?
\end{itemize}

\chapter{Application IV: Pair Production via Compton Scattering (Trident/Breit-Wheeler)}

Work to be done:
See previous chapter but with number of pairs through ``secondary'' processes.

\chapter{Conclusion}

%\backmatter

\bibliographystyle{osajnl}
\bibliography{phd_thesis}

\appendix

\chapter{Explicit expressions of the Stratton-Chu equations}

In chapter \ref{chapter:stratton-chu}, we discussed the numerical evaluation
of the Stratton-Chu equations as a way to model electromagnetic fields in the
tightly focused regime. Specifically, we implemented a program that evaluates
\eqref{} for arbitrary mirror geometries, arbitrary incident fields and capable
of modeling broadband pulses. In this appendix, we provide explicit expressions
of the Stratton-Chu equations in cylindrical coordinates and write down a far-field
approximation of those equations.

\section{Explicit expression in cylindrical coordinates}

Our starting point is \eqref{}, which we print here for convenience
  \begin{subequations}
  \label{eq:app.sc-explicit.poa-og}
  \begin{align}
    \label{eq:app.sc-explicit.poa-og.efield}
    \vb{E}'_\text{ref}(\vb{r}',k)  &= 2\iint_S
      \left\{
        ik(\vu{n}\times\vb{B}_\text{inc})g
        +\left(\vu{n}\cdot\vb{E}_\text{inc}\right)\nabla g\right\}dS
            + \frac{2}{ik}\oint_{\partial S}\nabla g
                    \vb{B}\cdot d\vb{\ell},\\
                    %\left[\vu{n}\times(\vu{n}\times\vb{B}_\text{inc})\right]\cdot d\vb{\ell},\\
    \label{eq:app.sc-explicit.poa-og.bfield}
    \vb{B}'_\text{ref}(\vb{r}',k)  &= 2\iint_S (\vu{n}\times\vb{B}_\text{inc})\times\nabla g dS.
  \end{align}
  \end{subequations}
where recall that
  \begin{align}
    g(\vb{r},\vb{r}') &= \frac{e^{ik\left|\vb{r}-\vb{r}'\right|}}{\left|\vb{r}-\vb{r}'\right|}, \\
    \left|\vb{r}-\vb{r}'\right| &= \sqrt{r^2+r'^2-2rr'\cos(\theta-\theta')-(z-z')^2}.
  \end{align}

Before we proceed, we'll show some useful intermediate results that will ease the parsing
of this expression. First, note that we compute the gradient of the Green's
function w.r.t. to the unprimed coordinates such that
  \begin{equation}
    \nabla g = \left(\frac{ik}{u}-\frac{1}{u^2}\right)\left[\left(r-r'\cos(\theta-\theta')\right)\vu{r}+r'\sin(\theta-\theta')\vu{\theta}+(z-z')\vu{z}\right]g = \left(\frac{ik}{u}-\frac{1}{u^2}\right)g\vb{G}
  \end{equation}
Also note that to extract the cylindrical components of the electromagnetic
field vectors, it will be necessary to evaluate the dot product of
\eqref{eq:app.sc-explicit.poa-og} with cylindrical basis vectors evaluated
at $\vb{r}'$ with cylindrical basis vectors evaluated at $\vb{r}$.
Because the cylindrical basis vectors form a non-coordinate basis, these
dot products do not vanish. In fact, we have
  \begin{subequations}
  \begin{align}
    \vu{r}'\cdot\vu{r}            &= (\cos\theta'\vu{x}+\sin\theta'\vu{y})\cdot(\cos\theta\vu{x}+\sin\theta\vu{y})
                                   = \cos\theta'\cos\theta+\sin\theta'\sin\theta
                                   = \cos(\theta-\theta') \\
    \vu{r}'\cdot\vu{\theta}       &= (\cos\theta'\vu{x}+\sin\theta'\vu{y})\cdot(-\sin\theta\vu{x}+\cos\theta\vu{y})
                                   = -\cos\theta'\sin\theta+\sin\theta'\cos\theta
                                   = -\sin(\theta-\theta')\\
    \vu{\theta'}\cdot\vu{r}       &= (-\sin\theta'\vu{x}+\cos\theta'\vu{y})\cdot(\cos\theta\vu{x}+\sin\theta\vu{y})
                                   = -\sin\theta'\cos\theta+\cos\theta'\sin\theta
                                   = \sin(\theta-\theta') \\
    \vu{\theta}'\cdot\vu{\theta}  &= (-\sin\theta'\vu{x}+\cos\theta'\vu{y})\cdot(-\sin\theta\vu{x}+\cos\theta\vu{y})
                                   = \sin\theta'\sin\theta+\cos\theta'\cos\theta
                                   = \cos(\theta-\theta')
  \end{align}
  \end{subequations}

To streamline the computation, we first compute the vector products contained
in each term of the integrands individually. This yields
  \begin{align}
    \vb{N}\times\vb{B}_\text{inc}
                &= \left[
                \left(n_\theta B_z-n_z B_\theta\right) \vu{r}
                    +\left(n_z B_r-n_r B_z\right)      \vu{\theta}
                    +\left(n_r B_\theta- n_\theta B_r\right)  \vu{z}
                  \right] \\
    \vb{N}\cdot\vb{E}_\text{inc}
                &= n_r E_r + n_\theta E_\theta + n_z E_z \\
    (\vb{N}\times\vb{B}_\text{inc})\times\vb{G}
                &= \left\{
                      \left[
                        \left( n_z B_r - n_r B_z \right) G_z
                        -\left( n_r B_\theta - n_\theta B_r \right) G_\theta
                      \right] \vu{r} \right. \nonumber\\
                &\quad+\left[
                        \left( n_r B_\theta - n_\theta B_r \right) G_r
                       -\left( n_\theta B_z - n_z B_\theta\right) G_z
                      \right]  \vu{\theta} \nonumber\\
                &\quad+\left.\left[
                    \left( n_\theta B_z-n_z B_\theta \right) G_\theta
                    -\left( n_z B_r - n_r B_z \right) G_r
                      \right]\vu{z}\right\}
  \end{align}
We can now extract the explicit expressions for the components of the reflected
electromagnetic fields, paying attention to the products of primed and unprimed
basis vectors:
%\todo[inline]{Check for multiline automatic sizing for \verb|\left| and \verb|\right|.}
  \begin{subequations}
  \begin{align}
    E_r'(\vb{r}', k)
          &= \vu{r}'\cdot\vb{E}'(\vb{r}',k) \nonumber\\
          &= 2\iint_S\left\{ikg \left[
              \left( n_\theta B_z -n_z B_\theta \right)\cos(\theta-\theta')
              +\left(n_r B_z -n_zB_r \right)         \sin(\theta-\theta')\right]\right.\nonumber\\
            &\quad \left.+\left(\frac{ik}{u}-\frac{1}{u^2}\right)g
                   \left(n_r E_r + n_\theta E_\theta + n_z E_z\right)\left(r\cos(\theta-\theta')-r'\right)\right\}dS \nonumber\\
            &\quad + \frac{2}{ik}\oint_{\partial S} \left(\frac{ik}{u}-\frac{1}{u^2}\right) g
                    \left(B_r l_r + B_\theta l_\theta + B_z l_z\right)\left(r\cos(\theta-\theta')-r'\right)dl,\\
   E_\theta'(\vb{r}',k)
          &=\vu{\theta}'\cdot\vb{E}'(\vb{r}',k) \nonumber\\
          &= 2\iint_S\left\{ikg \left[
              \left(n_\theta B_z - n_z B_\theta\right)\sin(\theta-\theta')
              +\left(n_z B_r  - n_r B_z\right)        \cos(\theta-\theta')\right]\right.\nonumber\\
            &\quad+\left(\frac{ik}{u}-\frac{1}{u^2}\right)g\left.\left(n_r E_r + n_\theta E_\theta + n_z E_z\right)
             r\sin(\theta-\theta')g\right\}dS \nonumber\\
            &\quad +\frac{2}{ik}\oint_{\partial S} \left(\frac{ik}{u}-\frac{1}{u^2}\right)g
                    \left(B_r l_r + B_\theta l_\theta + B_z l_z\right)r\sin(\theta-\theta')dl \\
  E_z'(\vb{r}',k)
          &= \vu{z}'\cdot\vb{E}'(\vb{r}',k) \nonumber\\
          &= 2\iint_S\left\{ikg \left(n_r B_\theta - n_\theta B_r\right)+\left(\frac{ik}{u}-\frac{1}{u^2}\right)\left( n_r E_r + n_\theta E_\theta + n_z E_z\right)(z-z')g\right\} dS\nonumber\\
            &\quad +\frac{2}{ik}\oint_{\partial S} \left(\frac{ik}{u}-\frac{1}{u^2}\right)g
              \left(B_r l_r + B_\theta l_\theta + B_z l_z\right)(z-z')dl
  \end{align}
The magnetic field gives
  \begin{align}
    B_r'(\vb{r}', k)
          &= \vu{r}'\cdot\vb{B}'(\vb{r}',k) \nonumber\\
          &= 2\iint_S \left(\frac{ik}{u}-\frac{1}{u^2}\right)g \left[
                \left(n_z B_r - n_r B_z \right) (z-z')\cos(\theta-\theta')\right.\nonumber\\
          &\quad\left.\left(
               +r\left(n_\theta B_r - n_r B_\theta\right)
               +\left(n_\theta B_z - n_z B_\theta\right)(z-z')\right)\sin(\theta-\theta')
               \right] \\
    B_\theta'(\vb{r}',k)
          &=\vu{\theta}'\cdot\vb{B}'(\vb{r}',k) \nonumber\\
          &= 2\iint_S \left(\frac{ik}{u}-\frac{1}{u^2}\right)g \left[
              \left(n_z B_r-n_r B_z\right)(z-z')\sin(\theta-\theta')\right. \nonumber\\
          &\quad +\left(n_z B_\theta - n_\theta B_z\right)(z-z')\cos(\theta-\theta') \nonumber\\
          &\quad\left.+\left(n_\theta B_r- n_r B_\theta\right)\left(r'-r\cos(\theta-\theta')\right)\right] dA \\
    B_z'(\vb{r}',k)
          &= \vu{z}'\cdot\vb{B}'(\vb{r}',k) \nonumber\\
          &= 2\iint_S \left(\frac{ik}{u}-\frac{1}{u^2}\right)g\left[
            \left(n_\theta B_z- n_z B_\theta\right)r'\sin(\theta-\theta') \right.\nonumber\\
          &\quad\left.+\left(n_r B_z - n_z B_r\right)\left(r-r'\cos(\theta-\theta')\right)\right] dA
  \end{align}
  \end{subequations}

For the given parametrization, the normal is given
  \begin{subequations}
  \begin{align}
    \vu{n} &= \frac{\nabla(z-F(r,\theta))}{\left|\nabla(z-F(r,\theta))\right|} \\
           &= \frac{\left[-\partial_r F(r,\theta)\vu{r}-\frac{1}{r}\partial_\theta F(r,\theta)\vu{\theta}+\vu{z}\right]}
                    {\sqrt{1+\left(\partial_r F(r,\theta\right)^2+\left(\frac{1}{r}\partial_\theta F(r,\theta)\right)^2}}
  \end{align}
while the surface element is given by
  \begin{equation}
    dS = dA\sqrt{1+\left(\partial_r F(r,\theta)\right)^2+\left(\frac{1}{r}\partial_\theta F(r,\theta)\right)^2}.
  \end{equation}
  \end{subequations}
Given that the normal vector is present only once in most of terms of the integrals,
the Jacobian due to the surface will conveniently cancel.

\section{Far-Field Expressions}

When using the Stratton-Chu equations, our interest lies in computing fields
in the tight focusing regime. As such, we will generally compute the fields
in a small region around the focal spot. In practice, this means that the mirror
is far away from the region over which we compute the field­. The approximation
that $|\vb{r}|\gg|\vb{r}'|$ can thus be used to simplify the expressions.
This is akin to a far-field approximation, except that the observation point is
close to the origin instead of far from it: it is instead the source point that
is far away.

To simplify the procedure, notice that $\nabla g = -\nabla' g$, such that we
start from
  \begin{subequations}
  \begin{align}
    \vb{E}'_\text{ref}(\vb{r}',k)  &= 2\iint_S
      \left\{
        ik(\vu{n}\times\vb{B}_\text{inc})g
        -\left(\vu{n}\cdot\vb{E}_\text{inc}\right)\nabla' g\right\}dS
        -\frac{2}{ik}\oint_{\partial S}\nabla' g
                    \vb{B}\cdot d\vb{\ell},\\
                    %\left[\vu{n}\times(\vu{n}\times\vb{B}_\text{inc})\right]\cdot d\vb{\ell},\\
    \vb{B}'_\text{ref}(\vb{r}',k)  &= -2\iint_S (\vu{n}\times\vb{B}_\text{inc})\times\nabla' g dS.
  \end{align}
  \end{subequations}
Given our approximation, we can write
  \begin{equation}
    |\vb{r}-\vb{r}'| = R-\frac{1}{R}\vb{r}\cdot\vb{r}'
  \end{equation}
and
  \begin{equation}
    g(\vb{r},\vb{r}') = \frac{e^{ikR}}{R}e^{-\frac{ik}{R}\vb{r}\cdot\vb{r}'}
  \end{equation}
where $R=|\vb{r}|$. The gradient thus yield the simple expression
  \begin{equation}
    \nabla'g = -\frac{ikg}{R}\vb{r}
  \end{equation}
\todo[inline]{Fix the notation for $|\vb{r}|/R$. Right now it's confusing as all hell.}
Substituting yields
  \begin{subequations}
  \begin{align}
    E_r'(\vb{r}', k)
          &= 2ik\iint_S\left\{ \left[
              \left( n_\theta B_z -n_z B_\theta \right)\cos(\theta-\theta')
              +\left(n_r B_z -n_zB_r \right)         \sin(\theta-\theta')\right]\right.\nonumber\\
            &\quad \left.+
                   \left(n_r E_r + n_\theta E_\theta + n_z E_z\right)R_r\cos(\theta-\theta')\right\}
                   \frac{e^{ikR}}{R}e^{\frac{-ik\vb{r}\cdot\vb{r}'}{R}}dS \\
   E_\theta'(\vb{r}',k)
          &= 2ik\iint_S\left\{\left[
              \left(n_\theta B_z - n_z B_\theta\right)\sin(\theta-\theta')
              +\left(n_z B_r  - n_r B_z\right)        \cos(\theta-\theta')\right]\right.\nonumber\\
            &\quad+\left.\left(n_r E_r + n_\theta E_\theta + n_z E_z\right)
             R_r\sin(\theta-\theta')\right\}\frac{e^{ikR}}{R}e^{\frac{-ik\vb{r}\cdot\vb{r}'}{R}}dS \\
  E_z'(\vb{r}',k)
          &= 2ik\iint_S\left\{
            \left(n_r B_\theta - n_\theta B_r\right)
            +\left( n_r E_r + n_\theta E_\theta + n_z E_z\right)R_z\right\}
            \frac{e^{ikR}}{R}e^{\frac{-ik\vb{r}\cdot\vb{r}'}{R}}dS
  \end{align}
The magnetic field gives
  \begin{align}
    B_r'(\vb{r}', k)
          &= 2ik\iint_S \left[
                \left(n_z B_r - n_r B_z \right) R_z\cos(\theta-\theta')\right.\nonumber\\
          &\quad\left.+\left(
               \left(n_\theta B_r - n_r B_\theta\right)R_r
               +\left(n_\theta B_z - n_z B_\theta\right)R_z\right)\sin(\theta-\theta')
               \right]\frac{e^{ikR}}{R}e^{\frac{-ik\vb{r}\cdot\vb{r}'}{R}} dS\\
    B_\theta'(\vb{r}',k)
          &= 2ik\iint_S \left[
              \left(n_z B_r-n_r B_z\right)R_z\sin(\theta-\theta')\right. \nonumber\\
          &\quad \left.-\left(\left(n_\theta B_r- n_r B_\theta\right)R_r
                +\left(n_\theta B_z- n_z B_\theta \right)R_z\right)\cos(\theta-\theta')\right]\frac{e^{ikR}}{R}e^{\frac{-ik\vb{r}\cdot\vb{r}'}{R}} dS \\
    B_z'(\vb{r}',k)
          &= 2ik\iint_S \left[\left(n_r B_z - n_z B_r\right)R_r\right]\frac{e^{ikR}}{R}e^{\frac{-ik\vb{r}\cdot\vb{r}'}{R}} dS.
  \end{align}
  \end{subequations}
Note that we ignored the line integral in these expressions. While this term is
formally necessary for the Stratton-Chu equations to be a solution of Maxwell's
equations, in practice its contribution can be shown to be negligible \cite{SOMEONE}.

To go further, it is necessary to specialize these equations a little. We assume
a paraboloid mirror such that $n_\theta=0$ and $R=\sqrt{r^2+z^2}=r^2/4f+f$. We also assume that every field component carries a
$e^{-ikz}$ phase term. Following the discussion in \ref{section on phase}, we
see that exponential term $e^{ikR-ikz}=e^{2ikf}$ factors out of the integrand.
We are left with
  \begin{subequations}
  \begin{align}
    E_r'(\vb{r}', k)
          &= 2ike^{2ikf}\iint_S\left\{ \left[
               -B_\theta \cos(\theta-\theta')
              +\left(-\frac{r}{2f} B_z -B_r \right)\sin(\theta-\theta')\right]\right.\nonumber\\
            &\quad \left.+
                   \left(-\frac{r}{2f} E_r + E_z\right)\frac{r}{R}\cos(\theta-\theta')\right\}
                   \frac{e^{\frac{-ik\vb{r}\cdot\vb{r}'}{R}}}{R}dA \\
   E_\theta'(\vb{r}',k)
          &= 2ike^{2ikf}\iint_S\left\{\left[
              - B_\theta\sin(\theta-\theta')
              +\left(B_r  + \frac{r}{2f} B_z\right)\cos(\theta-\theta')\right]\right.\nonumber\\
            &\quad+\left.\left(-\frac{r}{2f} E_r + E_z\right)
             \frac{r}{R}\sin(\theta-\theta')\right\}\frac{e^{\frac{-ik\vb{r}\cdot\vb{r}'}{R}}}{R}dA \\
  E_z'(\vb{r}',k)
          &= 2ike^{2ikf}\iint_S\left\{
            -\frac{r}{2f} B_\theta
            +\left( -\frac{r}{2f} E_r  +E_z\right)\frac{z}{R}\right\}
            \frac{e^{\frac{-ik\vb{r}\cdot\vb{r}'}{R}}}{R}dA
  \end{align}
The magnetic field gives
  \begin{align}
    B_r'(\vb{r}', k)
          &= 2ike^{2ikf}\iint_S \left[
                \left(B_r + \frac{r}{2f} B_z \right) \frac{z}{R}\cos(\theta-\theta')
               +B_\theta\sin(\theta-\theta')
               \right]\frac{e^{\frac{-ik\vb{r}\cdot\vb{r}'}{R}}}{R} dA\\
    B_\theta'(\vb{r}',k)
          &= 2ike^{2ikf}\iint_S \left[
              \left(B_r + \frac{r}{2f} B_z\right)\frac{z}{R}\sin(\theta-\theta')
                - B_\theta \cos(\theta-\theta')\right]
                \frac{e^{\frac{-ik\vb{r}\cdot\vb{r}'}{R}} }{R}dA \\
    B_z'(\vb{r}',k)
          &= -2ike^{2ikf}\iint_S \left[\left(\frac{r}{2f} B_z + B_r\right)\frac{r}{R}\right]
          \frac{e^{\frac{-ik\vb{r}\cdot\vb{r}'}{R}}}{R} dA.
  \end{align}
  \end{subequations}

\subsection{Analytic Solutions for Some Field Models}
In the far-field approximation, it is possible to evaluate the integrals
for some simple field models. In the following, we will extensively use the
relation \cite[\S9.1.21]{Abramowitz1965}
  \begin{equation}
    \int_0^{2\pi} \cos(n\theta)e^{iz\cos\theta}= 2\pi i^n J_n(z).
  \end{equation}

\paragraph{Linear polarization}
For a linearly polarized beam, we have
  \begin{equation}
    B_r = -E_0(r)\sin\theta; B_\theta=-E_0(r)\cos(\theta); B_z=0.
  \end{equation}

We can write $B_z$ as
  \begin{equation*}
    B_z = 2ike^{2ikf}\int_0^{r_\text{max}}\int_0^{2\pi}
            E_0(r)\frac{r^2}{\left(r^2/4f+f\right)^2}\sin\theta\exp\left[-\frac{ik}{r^2/4f+f}\left(rr'\cos(\theta-\theta')+zz'\right)\right]d\theta dr
  \end{equation*}
Since the integrand is periodic with period $2\pi$, we can apply the transformation
$\theta\mapsto\theta-\theta'$ and write
  \begin{equation*}
    B_z = 2ike^{2ikf}\int_0^{r_\text{max}}\int_0^{2\pi}
            E_0(r)\frac{r^2}{\left(r^2/4f+f\right)^2}\sin(\theta-\theta')\exp\left[-\frac{ik}{r^2/4f+f}\left(rr'\cos\theta+zz'\right)\right]d\theta dr
  \end{equation*}
Applying the difference formula and noting that $\int_0^{2\pi}\sin\theta F(\cos\theta)d\theta=0$,
we obtain
  \begin{equation*}
    B_z = -2ike^{2ikf}\sin\theta'
          \int_0^{r_\text{max}}
            E_0(r)\frac{r^2}{\left(r^2/4f+f\right)^2}e^{-\frac{ikzz'}{r^2/4f+f}}
          \int_0^{2\pi}
            \cos\theta\exp\left[-\frac{ik}{r^2/4f+f}\left(rr'\cos\theta\right)\right]
          d\theta dr
  \end{equation*}
We can perform the angular integration to yield
  \begin{equation*}
    B_z = -4\pi ke^{2ikf}\sin\theta'
          \int_0^{r_\text{max}}
            E_0(r)\frac{r^2}{\left(r^2/4f+f\right)^2}e^{-\frac{ikzz'}{r^2/4f+f}}
          J_1\left(kr'\frac{4fr}{r^2+4f^2}\right)
          dr
  \end{equation*}
where $J_1(z)$ is the Bessel function of the first kind. We can simplify this
by substituting $z=r^2/4f-f$, defining $\rho=r/r_\text{max}$ and $\alpha=2f/r_\text{max}$.
This yields
  \begin{equation*}
    B_z = -16\pi\alpha^2 kfe^{2ikf}\sin\theta'
          \int_0^{1}
            E_0(r_\text{max}\rho)\frac{\rho^2}{\left(\rho^2+\alpha^2\right)^2}e^{-ikz'\frac{\rho^2-\alpha^2}{\rho^2+\alpha^2}}
          J_1\left(2\alpha kr'\frac{\rho}{\rho^2+\alpha^2}\right)
          d\rho
  \end{equation*}
As it stands, this cannot be integrated. We can perform another substitution,
$\rho=\alpha\tan x$, $d\rho=\alpha\sec^2xdx$ and write
  \begin{equation*}
    B_z = -16\pi\alpha kfe^{2ikf}\sin\theta'
          \int_{\arctan(0)}^{\arctan(1/\alpha)}
            E_0(r_\text{max}\alpha\tan x)\sin^2xe^{ikz\cos2x}
          J_1\left(2kr'\cos x\sin x\right)
          dx
  \end{equation*}
This still can't be integrated. We perform yet another substitution, $t=\cos x$, $dt=-\sin x dx$
and write
  \begin{equation*}
    B_z = 16\pi\alpha kfe^{2ikf}\sin\theta'e^{-ikz'}
          \int_{1}^{1/\sqrt{1+1/\alpha^2}}
            E_0\left(r_\text{max}\alpha\frac{\sqrt{1-t^2}}{t}\right)\sqrt{1-t^2}e^{2ikz't^2}
          J_1\left(2kr't\sqrt{1-t^2}\right)
          dt.
  \end{equation*}
Using the power series representation of the Bessel function, we can get
    \begin{multline*}
    B_z = 16\pi\alpha kfe^{2ikf}\sin\theta'e^{-ikz'}
          \sum_{m=0}^\infty\frac{(-1)^m}{m!(m+1)!}(kr')^{2m+1}\\
          \times\int_{1}^{1/\sqrt{1+1/\alpha^2}}
            E_0\left(r_\text{max}\alpha\frac{\sqrt{1-t^2}}{t}\right)\left(1-t^2\right)^{m+1}t^{2m+1}e^{2ikz't^2}
          dt.
  \end{multline*}
Applying the binomial theorem on the $1-t^2$ yields
  \begin{multline*}
    B_z = 16\pi\alpha kfe^{2ikf}\sin\theta'e^{-ikz'}
          \sum_{m=0}^\infty\frac{(-1)^m}{m!(m+1)!}(kr')^{2m+1}\sum_{k=0}^{m+1}(-1)^k\binom{m+1}{k}\\
          \times\int_{1}^{1/\sqrt{1+1/\alpha^2}}
            E_0\left(r_\text{max}\alpha\frac{\sqrt{1-t^2}}{t}\right)t^{2k+2m+1}e^{2ikz't^2}
          dt.
  \end{multline*}
To go further, we must choose a field model that allows this integral to be evaluated.
As a first step, we will choose a top-hat field, i.e. $E_0=1$. The integrand
is thus the incomplete gamma function and we can write
  \begin{multline*}
    B_z = -8\pi\alpha kfe^{2ikf}\sin\theta'e^{-ikz'}
          \sum_{m=0}^\infty\frac{(-1)^m}{m!(m+1)!}(kr')^{2m+1}\sum_{k=0}^{m+1}(-1)^k\binom{m+1}{k}
          \left.
          \frac{\Gamma(m+k+1,-2ict^2)}{(-2ic)^{m+k+1}}
          \right|^{1/\sqrt{1+1/\alpha^2}}_1.
  \end{multline*}
We can simplify this to
  \begin{equation*}
    B_z = 8\pi\alpha kef^{2ikf}\sin\theta'e^{-ikz'}
          \sum_{m=0}^\infty\frac{(kr')^{2m+1}}{m!(m+1)!}\sum_{k=0}^{m+1}\binom{m+1}{k}
          \left.
          \frac{\Gamma(m+k+1,-2ikz't^2)}{(2ikz')^{m+k+1}}
          \right|^{1/\sqrt{1+1/\alpha^2}}_1.
  \end{equation*}
Because $m+k+1\in\mathbb{N}$, we can write
  \begin{equation*}
    B_z = 8\pi\alpha kfe^{2ikf}\sin\theta'e^{-ikz'}
          \sum_{m=0}^\infty\frac{(kr')^{2m+1}}{m!(m+1)!}\sum_{k=0}^{m+1}\binom{m+1}{k}
          \left.
          \frac{(m+k)!}{(2ikz')^{m+k+1}}e^{2ikz't^2}\sum_{\ell=0}^{m+k}\frac{(-2ikz't^2)^\ell}{\ell!}
          \right|^{1/\sqrt{1+1/\alpha^2}}_1.
  \end{equation*}
In terms of our original variable, this is
  \begin{multline*}
    B_z = 8\pi\alpha kfe^{2ikf}\sin\theta'
          \sum_{m=0}^\infty\frac{(kr')^{2m+1}}{m!(m+1)!}\sum_{k=0}^{m+1}\binom{m+1}{k}\frac{(m+k)!}{(2ikz')^{m+k+1}}\\
          \left.
          \sum_{\ell=0}^{m+k}\frac{(-1)^\ell}{\ell!}(2ikz')^\ell\left(1+\frac{\rho^2}{\alpha^2}\right)^{-\ell}\exp\left[-ikz'\frac{\rho^2-\alpha^2}{\rho^2+\alpha^2}\right]
          \right|^1_0,
  \end{multline*}
and, finally,
  \begin{multline*}
    B_z = 8\pi\alpha kfe^{2ikf}\sin\theta'
          \sum_{m=0}^\infty\frac{(kr')^{2m+1}}{m!(m+1)!}\sum_{k=0}^{m+1}\binom{m+1}{k}\frac{(m+k)!}{(2ikz')^{m+k+1}}\\
          \sum_{\ell=0}^{m+k}\frac{(-1)^\ell}{\ell!}(2ikz')^\ell
            \left[\left(1+\frac{1}{\alpha^2}\right)^{-\ell}\exp\left[ikz'\frac{\alpha^2-1}{\alpha^2+1}\right]-e^{ikz'}\right].
  \end{multline*}

We can perform the other integrals in a similar fashion, although the expressions
will be quite a big longer. We can write
  \begin{multline*}
    B_r' = -2ikfe^{2ikf}\int_0^{r_\text{max}}\int_0^{2\pi} \frac{rE_0(r)}{R^2}
      \left[z\sin(\theta-\theta')\cos\theta+R\cos(\theta-\theta')\sin\theta\right]\\
        \times\exp\left[-\frac{ik}{r^2/4f+f}\left(rr'\cos\theta+zz'\right)\right]d\theta dr
  \end{multline*}
We can reduce this to Bessel function integrals by applying the difference formula
on $\cos(\theta-\theta')$ and $\sin(\theta-\theta')$, and the power reduction formula
on the ensuing trigonometric functions. This yields
  \begin{multline*}
    B_r' = 2\pi ike^{2ikf}\sin\theta'\int_0^{r_\text{max}} E_0(r)
      \left[\frac{rz}{\left(r^2/4f+f\right)^2}\left(J_0\left(4fkr'\frac{r}{r^2+4f^2}\right)-J_2\left(4fkr'\frac{r}{r^2+4f^2}\right)\right)\right.\\
        \left.-
          \frac{r}{\left(r^2/4f+f\right)}\left(J_0\left(4fkr'\frac{r}{r^2+4f^2}\right)+J_2\left(4fkr'\frac{r}{r^2+4f^2}\right)\right)\right]
  \end{multline*}
Similarly, we can write $B_\theta'$ as
  \begin{multline*}
    B_\theta' = 2\pi ike^{2ikf}\cos\theta'\int_0^{r_\text{max}} E_0(r)
      \left[-\frac{rz}{\left(r^2/4f+f\right)^2}\left(J_0\left(4fkr'\frac{r}{r^2+4f^2}\right)+J_2\left(4fkr'\frac{r}{r^2+4f^2}\right)\right)\right.\\
        \left.+
          \frac{r}{\left(r^2/4f+f\right)}\left(J_0\left(4fkr'\frac{r}{r^2+4f^2}\right)-J_2\left(4fkr'\frac{r}{r^2+4f^2}\right)\right)\right]
  \end{multline*}
We can see that the Cartesian components will be much simpler, given the symmetry of
these equations. Indeed, we have
  \begin{align}
    B_x' &= -4\pi ike^{2ikf}\cos\theta'\sin\theta'\int_0^{r_\text{max}} E_0(r)
          J_0\left(4fkr'\frac{r}{r^2+4f^2}\right)\frac{r}{R}\left(1-\frac{z}{R}\right)dr \\
    B_y' &= 2\pi ike^{2ikf}\int_0^{r_\text{max}}\frac{r}{R}
          \left[\cos(2\theta')\left(1-\frac{z}{R}\right)J_0\left(4fkr'\frac{r}{r^2+4f^2}\right)
                -\left(1+\frac{z}{R}\right)J_2\left(4fkr'\frac{r}{r^2+4f^2}\right)\right]dr
  \end{align}
Expressing this in terms or our scaled variables and simplifying the $z$ terms
yields
  \begin{align}
    B_x' &=-32\pi i\alpha^2 kfe^{2ikf}\cos\theta'\sin\theta'
          \int_0^1 E_0(r_\text{max}\rho)\frac{\rho}{(\rho^2+\alpha^2)^2}
            J_0\left(2\alpha kr'\frac{\rho}{\rho^2+\alpha^2}\right)d\rho\\
    B_y' &=16\pi ikfe^{2ikf}\int_0^1 E_0(r_\text{max}\rho)\frac{\rho}{(\rho^2+\alpha^2)^2}
      \left[
        \alpha^2\cos2\theta'J_0\left(2\alpha kr'\frac{\rho}{\rho^2+\alpha^2}\right)
       -\rho^2J_2\left(2\alpha kr'\frac{\rho}{\rho^2+\alpha^2}\right)
       \right]d\rho
\end{align}

We can perform the same substitutions as before and obtain
  \begin{align}
    B_x' &= -16\pi ikfe^{2ikf}\cos\theta'\sin\theta'e^{-ikz'}\sum_{m=0}^\infty \frac{(-1)^m}{(m!)^2}(kr')^{2m}
              \sum_{k=0}^m\binom{m}{k}\frac{(-1)^k}{(-2ikz')^{k+m+1}}\Gamma(k+m+1,-2ikz't^2) \\
    B_y' &= 8\pi ikfe^{2ikf}e^{-ikz'}
            \left[
            \cos2\theta'\sum_{m=0}^\infty\frac{(-1)^m}{(m!)^2}
            \sum_{k=0}^m\binom{m}{k}\frac{(-1)^k}{(-2ikz')^{k+m+1}}\Gamma(k+m+1,-2ikz't^2)\right. \\
         & \left.+\sum_{m=0}\frac{(-1)^m}{m!(m+2)!}(kr')^{2m+2}\sum_{k=0}^{m+2}\binom{m+2}{k}\frac{(-1)^k}{(-2ikz')^{k+m+1}}\Gamma(m+k+1,-2ikz't^2)\right].
  \end{align}

The electric field have similar expressions. We have
  \begin{align}
    E_r' &= 2ike^{2ikf}\int_0^{r_\text{max}}\int_0^{2\pi}
              E_0(r)e^{-ikzz'/R}\cos\theta'\left[-\frac{r^2-4f^2}{r^2+4f^2}\cos^2\theta +\sin^2\theta\right]e^{-ikrr'\cos\theta/R}rdrd\theta\\
    E_\theta' &= 2ike^{2ikf}\int_0^{r_\text{max}}\int_0^{2\pi}
              E_0(r)e^{-ikzz'/R}\sin\theta'\left[-\frac{r^2-4f^2}{r^2+4f^2}\sin^2\theta+\cos^2\theta\right]e^{-ikrr'\cos\theta/R}rdrd\theta \\
    E_z' &= 32ikf^2e^{2ikf}\int_0^{r_\text{max}}E_0(r)e^{-ikzz'/R}\cos\theta'\frac{r^2}{(r^2+4f^2)^2}\cos\theta e^{-ikrr'\cos\theta/R}drd\theta
  \end{align}
Using the power-reduction formulae and the representation of the Bessel functions, 
we can simplify this to
  \begin{align}
    E_x' &= 32\pi ikf^2e^{2ikf}\int_0^{r_\text{max}}\frac{4fr}{(r^2+4f^2)^2}\left(\cos2\theta'J_0()+J_2()\right)dr \\
    E_y' &= 64\pi ikf^2e^{2ikf}\cos\theta'\sin\theta'\int_0^{r_\text{max}}\frac{4fr}{(r^2+4f^2)^2}J_0() \\
    E_z' &= -64\pi kf^2e^{2ikf}\cos\theta'\int_0^{r_\text{max}}\frac{r^2}{(r^2+4f^2)^2}J_1().
  \end{align}
Expressing this in terms of our scaled variables yields
  \begin{align}
    E_x' &= 32\pi ikf\alpha^2e^{2ikf}\int_0^{1}\frac{\rho}{(\rho^2+\alpha^2)^2}\left(\cos2\theta'J_0()+J_2()\right)d\rho \\
    E_y' &= 64\pi ikf\alpha^2e^{2ikf}\cos\theta'\sin\theta'\int_0^{1}\frac{\rho}{(\rho^2+\alpha^2)^2}J_0()d\rho \\
    E_z' &= -64\pi kf\alpha e^{2ikf}\cos\theta'\int_0^{1}\frac{\rho^2}{(\rho^2+\alpha^2)^2}J_1()d\rho.
  \end{align}

\todo{Rewrite by first stating all of the components in terms of $\rho$ and perform
the $\theta$ integrals. State the components as an integral over the relevant
Bessel functions. Maybe compare to RW at that point. Then introduce the power-series
representation, and the incomplete gamma function expression.s}

\chapter{Explicit Expressions for Four-Wave Mixing from the Euler-Heisenberg Lagrangian}

\todo[inline]{Appendix summary and references to main text.}

\section{Solution of the Non-Linear Maxwell Equations}
It is possible to derive the polarization and magnetization vectors ($\vb{P}$ and $\vb{M}$)
that arise from the spontaneous creation and annihilation of virtual electron-positron
pairs from the Euler-Heisenberg (EH) Lagrangian. To do so, we use the weak-field
approximation of the EHL and compute the classical equations of motion that arise
from it. We can write
  \begin{subequations}
  \begin{align}
    \vb{P} &= \frac{4\alpha^2}{45}\left[ 4\mathcal{F}\vb{E}+7\mathcal{G}\vb{B}\right], \label{eq:app.fwm.polarization}\\
    \vb{M} &= \frac{4\alpha^2}{45}\left[-4\mathcal{F}\vb{B}+7\mathcal{G{\vb{E}}}\right]
  \end{align}
  \end{subequations}
where $\mathcal{F}$ and $\mathcal{G}$ are the Lorentz invariants defined in \label{somewhere}.

We can now derive equations of motions for the electromagnetic field from the
macroscopic version of Maxwell's equations:
  \begin{subequations}
  \begin{align}
    \nabla\times\vb{E} &= -\frac{\partial\vb{B}}{\partial t}, \\
    \nabla\times\vb{H} &=  \frac{\partial\vb{D}}{\partial t}, \\
    \nabla\cdot\vb{D}  &= 0, \\
    \nabla\cdot\vb{B}  &= 0
  \end{align}
  \end{subequations}
where the displacement field $\vb{D}$ and the magnetizing field $\vb{H}$ are
related to the polarization and magnetization $\vb{P}$ and $\vb{M}$ via
  \begin{subequations}
  \begin{align}
    \vb{D}  &=\vb{E}+\vb{P}, \\
    \vb{H}  &=\vb{B}-\vb{M}.
  \end{align}
  \end{subequations}
Taking the curl of the curl equations above and using the fact that the
divergence of $\vb{D}$ and $\vb{B}$ vanish, we can derive inhomogeneous
wave equations for both the electric and magnetic fields
  \begin{subequations}
  \begin{align}
    \left[\partial_t^2-\nabla^2\right]\vb{E}
                  &= -\partial_t\left[\nabla\times\vb{M}\right]-\partial_t^2\vb{P}+\nabla\left[\nabla\cdot\vb{P}\right], \\
    \left[\partial_t^2-\nabla^2\right]\vb{B}
                  &= \partial_t\left[\nabla\times\vb{P}\right]-\nabla^2\vb{M}+\nabla\left[\nabla\cdot\vb{M}\right].
  \end{align}
  \end{subequations}
As they stand, these equations are nonlinear partial differential equations and
can be incredibly difficult to solve. To simplify the process, we linearize these
equations by writing the total field as
  \begin{align}
    \vb{E}  &= \vb{E}_0 + \vb{E}_\text{gen} \\
    \vb{B}  &= \vb{B}_0 + \vb{B}_\text{gen}
  \end{align}
where $\vb{E}_0$ and $\vb{B}_0$ are solutions of the homogeneous wave equations
and $\vb{E}_\text{gen}$ and $\vb{B}_\text{gen}$ are the fields generated by the
non-linearity. We assume that $|\vb{E}_\text{gen}|\ll|\vb{E}_0|$ such that we
can write
  \begin{subequations}
  \begin{align}
    \left[\partial_t^2-\nabla^2\right]\vb{E}_\text{gen}
                  &= -\partial_t\left[\nabla\times\vb{M}_0\right]-\partial_t^2\vb{P}_0+\nabla\left[\nabla\cdot\vb{P}_0\right]
                  = \vb{F}_E \\
    \left[\partial_t^2-\nabla^2\right]\vb{B}_\text{gen}
                  &= \partial_t\left[\nabla\times\vb{P}_0\right]-\nabla^2\vb{M}_0+\nabla\left[\nabla\cdot\vb{M}_0\right]=\vb{F}_B
  \end{align}
  \end{subequations}
which is an inhomogeneous wave equation for $\left\{\vb{E}_0,\vb{B}_0\right\}$
with a \textit{known} source term. For our purposes, it will be useful to work
in frequency space. We write
  \begin{equation}
    \mathcal{F}\left[\vb{C}(\vb{r},t)\right] = \int_{-\infty}^\infty \vb{C}(\vb{r},t)e^{-i\omega t}d\omega
  \end{equation}
where $\vb{C}$ stands each for the fields in the PDE. Now, note that the polarization
and magnetization $\vb{P}_0$ and $\vb{M}_0$ are cubic functions of the applied fields
$\vb{E}_0$ and $\vb{B}_0$. As such, their Fourier expansion will involve taking
the cube of the Fourier expansion of the applied fields. We will explicitly evaluate
this operation a little later in this section.

Fourier transforming both sides of the PDEs and commuting the temporal derivatives
inside the integral sign yields, paying close attention to the signs
  \begin{subequations}
  \begin{align}
    \left[\nabla^2+k^2\right]\vb{E}_\text{gen}(\vb{r},\omega)
      &= i\omega\nabla\times\vb{M}_0(\vb{r},\omega) + \omega^2 \vb{P}_0(\vb{r},\omega)+\nabla\left[\nabla\cdot\vb{P}_0(\vb{r},\omega)\right], \\
    \left[\nabla^2+k^2\right]\vb{B}_\text{gen}(\vb{r},\omega)
      &= i\omega\nabla\times\vb{P}_0(\vb{r},\omega) + \nabla^2\vb{M}_0(\vb{r},\omega)-\nabla\left[\nabla\cdot\vb{M}_0(\vb{r},\omega)\right].
  \end{align}
  \end{subequations}
This yields inhomogeneous Helmholtz equations for the generated electric and
magnetic fields. They can be solved by using the Green's function of the
Helmholtz equation. Generically, we have
  \begin{equation}
    \vb{C}(\vb{r}',\omega)
      = \int_{\mathbb{R}^3} \vb{F}(\vb{r},\omega)\frac{e^{i\omega\left|\vb{r}-\vb{r}'\right|}}{4\pi\left|\vb{r}-\vb{r}'\right|}d^3\vb{r}.
  \end{equation}
Applying this solution to the generated electric and magnetic fields, we
can notice that this gives expressions with multiple spatial derivatives
to compute. These are difficult to evaluate numerically, but we can use the
far-field approximation and the chain rule to considerably simplify these
expressions.

For the far-field approximation to make sense, we will make the assumption
that the support $D$ of both $\vb{P}_0$ and $\vb{M}_0$ is smaller than a sphere of
radius $\ell$. This is not quite true, as the applied field falls off as
$1/R$, consequently the polarization and magnetization fall off as $1/R^3$.
In practice, we will vary the region of integration $D$ until some some predefined
convergence measure is achieved. In tightly focused fields configuration, $D$ will be
on the order of $\lambda^3$. The far-field approximation can thus be formulated
as the observation point $\vb{r}'$ being very far away from the applied field,
i.e. $|\vb{r}'|\gg\ell$. In the integrands, this will translate to $|\vb{r}|'\gg|\vb{r}|$.
We can expand the distance function using the law of cosines
  \begin{equation}
    |\vb{r}-\vb{r}'| = \sqrt{|\vb{r}|^2+|\vb{r}'|^2-2|\vb{r}||\vb{r}'|\cos\theta}\simeq |\vb{r}'|-\frac{1}{R}\vb{r}'\cdot\vb{r}.
  \end{equation}
\todo[inline]{Fix the notation for $\vb{r}'|/R$.  Right now it's confusing.}
Substituting this result in the Green's function yields
  \begin{equation}
    g(\vb{r},\vb{r}')\simeq \frac{e^{i\omega R}e^{-i\omega \vb{r}'\cdot\vb{r}/R}}{R}.
  \end{equation}

To remove the spatial derivatives, we use the following vector product
rules
Using this result in conjunction with product rules for vector calculus and volume-surface
integrals, we can write
  \begin{subequations}
  \begin{align}
    \psi\nabla\phi                &= -\nabla\psi\phi + \nabla(\psi\phi) \\
    \psi(\nabla\times\vb{C})      &= -\nabla\phi\times\vb{C} + \nabla\times(\psi\vb{C}) \\
    \psi(\nabla\cdot\vb{C})       &= -\vb{C}\cdot\nabla\psi + \nabla\cdot(\psi\vb{C}) \\
    \nabla\times\nabla\times\vb{C}&= \nabla[\nabla\cdot\vb{C}] - \nabla^2\vb{C}
  \end{align}
  \end{subequations}
and notice that since the integration is over the finite support of the integrands,
the surface terms that are generated by the total derivative terms vanish.
For the terms that contain second derivatives, notice that the gradient of the
Green's function does not actually depend on $\vb{r}$:
\begin{equation}
    \nabla_r g(\vb{r},\vb{r}') = -\frac{i\omega g}{R}\vb{r}'.
  \end{equation}
It is thus possible to simply reuse the vector product rule on the
remaining derivatives.
Finally, we can write
  \begin{subequations}
  \begin{align}
    \vb{E}_\text{gen}(\vb{r}',\omega)
        &= \frac{\omega^2e^{i\omega R}}{4\pi R}\int_D \left[-\vu{r}'\times \vb{M}_0(\vb{r},\omega)+\vb{P}_0(\vb{r},\omega)-\vu{r}'\left[\vu{r}'\cdot\vb{P}_0(\vb{r},\omega)\right]\right]e^{-i\omega \frac{\vb{r}'\cdot\vb{r}}{R}}d^3\vb{r}, \\
    \vb{B}_\text{gen}(\vb{r}',\omega)
        &= \frac{\omega^2e^{i\omega R}}{4\pi R}\int_D \left[+\vu{r}'\times \vb{P}_0(\vb{r},\omega)+\vb{M}_0(\vb{r},\omega)-\vu{r}'\left[\vu{r}'\cdot\vb{M}_0(\vb{r},\omega)\right]\right]e^{-i\omega \frac{\vb{r}'\cdot\vb{r}}{R}}d^3\vb{r},
  \end{align}
  \end{subequations}
which give the generated field at a far-field position $\vb{r}'$ as an integral
over the polarization and magnetization generated by the applied fields $\vb{E}_0$
and $\vb{B}_0$. Notice that, in this form, the expression for the magnetic field
can be obtain from the expression of the electric field by the mapping
$\vb{P}_0\mapsto\vb{M}_0$ and $\vb{M}_0\mapsto-\vb{P}_0$.

\section{Explicit expressions in cylindrical coordinates}

We now write down the explicit expressions of each component in cylindrical
coordinates. We will have to evaluate the cross-product of cylindrical
basis vectors evaluated at different points, similar to what we have done in
Appendix~\ref{}. We first write
  \begin{subequations}
  \begin{align}
    \vu{r}'\times\vu{r}           &= (\cos\theta'\vu{x}+\sin\theta'\vu{y})\times(\cos\theta\vu{x}+\sin\theta\vu{y})
                                   = (\cos\theta'\sin\theta-\sin\theta'\cos\theta)\vu{z}
                                   = \sin(\theta-\theta')\vu{z} \\
    \vu{r}'\times\vu{\theta}      &= (\cos\theta'\vu{x}+\sin\theta'\vu{y})\times(-\sin\theta\vu{x}+\cos\theta\vu{y})
                                   = (\cos\theta'\cos\theta+\sin\theta'\sin\theta)\vu{z}
                                   = \cos(\theta-\theta')\vu{z}\\
    \vu{r}'\times\vu{z}           &= -\vu{\theta}' \\
    \vu{\theta'}\times\vu{r}       &= (-\sin\theta'\vu{x}+\cos\theta'\vu{y})\times(\cos\theta\vu{x}+\sin\theta\vu{y})
                                   = (-\sin\theta'\sin\theta-\cos\theta'\cos\theta)\vu{z}
                                   = -\cos(\theta-\theta')\vu{z} \\
    \vu{\theta}'\times\vu{\theta} &= (-\sin\theta'\vu{x}+\cos\theta'\vu{y})\times(-\sin\theta\vu{x}+\cos\theta\vu{y})
                                   = (\sin\theta'\cos\theta+\cos\theta'\sin\theta)\vu{z}
                                   = \sin(\theta-\theta')\vu{z}\\
    \vu{\theta}'\times\vu{z}      &= \vu{r}' \\
    \vu{z}'\times\vu{r}           &= \vu{\theta} \\
    \vu{z}'\times\vu{\theta}      &= -\vu{r} \\
    \vu{z}'\times\vu{z}           &= 0.
  \end{align}
  \end{subequations}
Writing each term invidiually,
  \begin{subequations}
  \begin{align}
    \vb{r}'\times\vb{M}_0 &= \left(R_r\vu{r}'+R_z\vu{z}'\right)\times\left(M_r\vu{r}+M_\theta\vu{\theta}+M_z\vu{z}\right) \\
                          &= R_r\left(M_r\sin(\theta-\theta')+M_\theta\cos(\theta-\theta')\right)\vu{z}
                            -R_rM_z\vu{\theta}' + R_zMr\vu{\theta} -R_zM_\theta \vu{r} \\
    \vb{r}'\left(\vb{r}'\cdot\vb{P}\right) &=\left(R_r \vu{r}' + R_z \vu{z}'\right)
                                        \left(R_rP_r\cos(\theta-\theta')-R_rP_\theta\sin(\theta-\theta')+R_zP_z\right).
  \end{align}
  \end{subequations}
Evaluating the dot products yield
  \begin{subequations}
  \begin{align}
    E_{r,\text{gen}}(\vb{r}',\omega)
        &= \vu{r}'\cdot\vb{E}_\text{gen}(\vb{r}',\omega) \nonumber\\
        &= \frac{\omega^2e^{i\omega R}}{4\pi R} \int_D
        \left[
          R_zM_\theta\cos(\theta-\theta')+R_zM_r\sin(\theta-\theta')
          +P_r\cos(\theta-\theta')-P_\theta\sin(\theta-\theta')\right.\nonumber\\
        &  \phantom{\frac{\omega^2e^{i\omega R}}{4\pi R} \int_D}\left.-R_r \left(R_rP_r\cos(\theta-\theta')-R_rP_\theta\sin(\theta-\theta')+R_zP_z\right)\right]\exp\left[{-i\omega \frac{rr'\cos(\theta-\theta')+zz'}{R}}\right]d^3\vb{r} \\
   E_{\theta,\text{gen}}(\vb{r}',\omega)
        &= \vu{\theta}'\cdot\vb{E}_\text{gen}(\vb{r}',\omega) \nonumber\\
        &= \frac{\omega^2e^{i\omega R}}{4\pi R} \int_D
        \left[
          R_rM_z-R_zM_r\cos(\theta-\theta')+R_zM_\theta\sin(\theta-\theta')+P_r\sin(\theta-\theta')+P_\theta\cos(\theta-\theta')\right]\exp\left[{-i\omega \frac{rr'\cos(\theta-\theta')+zz'}{R}}\right]d^3\vb{r}\\
  E_{z,\text{gen}}(\vb{r}',\omega)
        &= \vu{z}'\cdot\vb{E}_\text{gen}(\vb{r}',\omega) \nonumber\\
        &= \frac{\omega^2e^{i\omega R}}{4\pi R} \int_D
          \left[-R_rM_r\sin(\theta-\theta')-R_rM_\theta\cos(\theta-\theta')+P_z \right.\nonumber\\
        &\phantom{\frac{\omega^2e^{i\omega R}}{4\pi R} \int_D}\left.
          -R_z \left(R_rP_r\cos(\theta-\theta')-R_rP_\theta\sin(\theta-\theta')+R_zP_z\right)\right]
          \exp\left[{-i\omega \frac{rr'\cos(\theta-\theta')+zz'}{R}}\right]d^3\vb{r}.
  \end{align}
As mentioned earlier, the magnetic field can readily be obtained by the simple
mapping $\vb{P}_0\mapsto\vb{M}_0$ and $\vb{M}_0\mapsto-\vb{P}_0$.
  \begin{align}
    B_{r,\text{gen}}(\vb{r}',\omega)
        &= \vu{r}'\cdot\vb{B}_\text{gen}(\vb{r}',\omega) \nonumber\\
        &= \frac{\omega^2e^{i\omega R}}{4\pi R} \int_D
        \left[
          -R_zM_\theta\cos(\theta-\theta')-R_zP_r\sin(\theta-\theta')
          +M_r\cos(\theta-\theta')-M_\theta\sin(\theta-\theta')\right.\nonumber\\
        &  \phantom{\frac{\omega^2e^{i\omega R}}{4\pi R} \int_D}\left.-R_r \left(R_rM_r\cos(\theta-\theta')-R_rM_\theta\sin(\theta-\theta')+R_zM_z\right)\right]\exp\left[{-i\omega \frac{rr'\cos(\theta-\theta')+zz'}{R}}\right]d^3\vb{r} \\
   B_{\theta,\text{gen}}(\vb{r}',\omega)
        &= \vu{\theta}'\cdot\vb{B}_\text{gen}(\vb{r}',\omega) \nonumber\\
        &= \frac{\omega^2e^{i\omega R}}{4\pi R} \int_D
        \left[
          -R_rP_z+R_zP_r\cos(\theta-\theta')-R_zP_\theta\sin(\theta-\theta')+M_r\sin(\theta-\theta')+M_\theta\cos(\theta-\theta')\right]\exp\left[{-i\omega \frac{rr'\cos(\theta-\theta')+zz'}{R}}\right]d^3\vb{r}\\
   B_{z,\text{gen}}(\vb{r}',\omega)
        &= \vu{z}'\cdot\vb{B}_\text{gen}(\vb{r}',\omega) \nonumber\\
        &= \frac{\omega^2e^{i\omega R}}{4\pi R} \int_D
          \left[R_rP_r\sin(\theta-\theta')+R_rP_\theta\cos(\theta-\theta')+M_z \right.\nonumber\\
        &\phantom{\frac{\omega^2e^{i\omega R}}{4\pi R} \int_D}\left.
          -R_z \left(R_rM_r\cos(\theta-\theta')-R_rM_\theta\sin(\theta-\theta')+R_zM_z\right)\right]
          \exp\left[{-i\omega \frac{rr'\cos(\theta-\theta')+zz'}{R}}\right]d^3\vb{r}.
  \end{align}
  \end{subequations}
\todo[inline]{Import command that pushes equations to the end of the line.}

\section{Modes}

To evaluate the integrals above, we must compute the range of frequencies
that will be generated through the non-linear interaction. To do so,
we simply must evaluate the Fourier expansion of $\vb{P}(\vb{r},t)$.
Substiting the Fourier transforms of the electric and magnetic fiels in
the r.h.s. of Eq.~\eqref{eq:app.fwm.polarization} yields
  \begin{equation}
    \vb{P}(\vb{r},t) = \frac{4\alpha^2}{45}\int_{-\infty}^\infty\int_{-\infty}^\infty\int_{-\infty}^\infty
                        \left[
                          4\left(\vb{E}_a\cdot\vb{E}_b-\vb{B}_a\cdot\vb{B}_b\right)\vb{E}_c
                         +7\left(\vb{E}_a\cdot\vb{B}_b\right)\vb{B}_c
                        \right]e^{-i(\omega_a+\omega_b+\omega_c)t}d\omega_ad\omega_bd\omega_c
  \end{equation}
where $\vb{E}_a$ is a shorthand for $\vb{E}(\vb{r},\omega_a)$. Using the fact
the fields must be real, we can write this integral as
  \begin{align}
    \vb{P}(\vb{r},t) 
        &= \frac{4\alpha^2}{45}\int_0^\infty\int_0^\infty\int_0^\infty
            \left[
              4\left(\vb{E}_ae^{-i\omega_a t}+\vb{E}_a^*e^{i\omega_a t}\right)
          \cdot\left(\vb{E}_be^{-i\omega_b t}+\vb{E}_b^*e^{i\omega_b t}\right)
               \left(\vb{E}_ce^{-i\omega_c t}+\vb{E}_c^*e^{i\omega_c t}\right)
            \right. \nonumber\\
        &\phantom{\frac{4\alpha^2}{45}\int_0^\infty\int_0^\infty\int_0^\infty}
             -4\left(\vb{B}_ae^{-i\omega_a t}+\vb{B}_a^*e^{i\omega_a t}\right)
          \cdot\left(\vb{B}_be^{-i\omega_b t}+\vb{B}_b^*e^{i\omega_b t}\right)
               \left(\vb{E}_ce^{-i\omega_c t}+\vb{E}_c^*e^{i\omega_c t}\right)
            \nonumber\\
        &\left.
             +7\left(\vb{E}_ae^{-i\omega_a t}+\vb{E}_a^*e^{i\omega_a t}\right)
          \cdot\left(\vb{B}_be^{-i\omega_b t}+\vb{B}_b^*e^{i\omega_b t}\right)
               \left(\vb{B}_ce^{-i\omega_c t}+\vb{B}_c^*e^{i\omega_c t}\right)
          \right].
  \end{align}
Evaluating the products and rearranging yields
  \begin{align}
    \vb{P}(\vb{r},t)
      &= \frac{4\alpha^2}{45}\int_0^\infty\int_0^\infty\int_0^\infty
        \left\{
          \left[
            4\left(\vb{E}_a\cdot\vb{E}_b-\vb{B}_a\cdot\vb{B}_b\right)\vb{E}_c+7\left(\vb{E}_a\cdot\vb{B}_b\right)\vb{B}_c
          \right]e^{-i(\omega_a+\omega_b+\omega_c)t}
        \right. \nonumber\\
      & \phantom{\frac{4\alpha^2}{45}\int_0^\infty\int_0^\infty\int_0^\infty}
          \left[
            4\left(\vb{E}_a\cdot\vb{E}_b-\vb{B}_a\cdot\vb{B}_b\right)\vb{E}_c^*+7\left(\vb{E}_a\cdot\vb{B}_b\right)\vb{B}_c^*
          \right]e^{-i(\omega_a+\omega_b-\omega_c)t}
         \nonumber\\
      & \phantom{\frac{4\alpha^2}{45}\int_0^\infty\int_0^\infty\int_0^\infty}
          \left[
            4\left(\vb{E}_a\cdot\vb{E}_b^*-\vb{B}_a\cdot\vb{B}_b^*\right)\vb{E}_c+7\left(\vb{E}_a\cdot\vb{B}_b^*\right)\vb{B}_c
          \right]e^{-i(\omega_a-\omega_b+\omega_c)t}
         \nonumber\\
      & \phantom{\frac{4\alpha^2}{45}\int_0^\infty\int_0^\infty\int_0^\infty}
          \left[
            4\left(\vb{E}_a^*\cdot\vb{E}_b-\vb{B}_a^*\cdot\vb{B}_b\right)\vb{E}_c+7\left(\vb{E}_a^*\cdot\vb{B}_b\right)\vb{B}_c
          \right]e^{-i(-\omega_a+\omega_b+\omega_c)t}
         \nonumber\\
      &  \phantom{\frac{4\alpha^2}{45}\int_0^\infty\int_0^\infty\int_0^\infty} \left.+ c.c.\right\}d\omega_ad\omega_bd\omega_c
  \end{align}
where c.c. denotes the complex conjugate of the expression before it.

To simplify this expression, we will discretize it, as is done in the C++
implementation and write
  \begin{equation}
    \vb{P}(\vb{r},t) = \frac{4\alpha^2}{45}\sum_a\sum_b\sum_c \left\{\;\right\}\Delta\omega^3
  \end{equation}
Denoting the smallest frequency over which we sum by $\omega_0$, we write the
frequencies as $\omega_a = \omega_0 + a\Delta\omega$. Substituting and renaming
some dummy indices
  \begin{align}
    \vb{P}(\vb{r},t)
      &= \frac{4\alpha^2}{45}\sum_{a=0}^{N}\sum_{b=0}^{N}\sum_{c=0}^{N} \left\{\right.\\
        &\left\{
          \left[
            4\left(\vb{E}_a\cdot\vb{E}_b-\vb{B}_a\cdot\vb{B}_b\right)\vb{E}_c+7\left(\vb{E}_a\cdot\vb{B}_b\right)\vb{B}_c
          \right]
        \right\}e^{-i(3\omega_0+(a+b+c)\Delta\omega)t} \nonumber\\
      & \left\{
          \left[
            4\left(\vb{E}_a\cdot\vb{E}_b-\vb{B}_a\cdot\vb{B}_b\right)\vb{E}_c^*+7\left(\vb{E}_a\cdot\vb{B}_b\right)\vb{B}_c^*
          \right]
         \right.\nonumber\\
      &
          \left[
            4\left(\vb{E}_a\cdot\vb{E}_c^*-\vb{B}_a\cdot\vb{B}_c^*\right)\vb{E}_b+7\left(\vb{E}_a\cdot\vb{B}_c^*\right)\vb{B}_b
          \right]
         \nonumber\\
      & \left.\left.
          \left[
            4\left(\vb{E}_c^*\cdot\vb{E}_b-\vb{B}_c^*\cdot\vb{B}_b\right)\vb{E}_a+7\left(\vb{E}_c^*\cdot\vb{B}_b\right)\vb{B}_a
          \right]
         \right\}e^{-i(\omega_0+(a+b-c)\Delta\omega)t} + c.c.\right\}\Delta\omega^3.
  \end{align}
To obtain the value of $\vb{P}(\vb{r},\omega)$ for each $\omega$, we must determine
the unique frequencies that are generated by the triple sum, and then identify
the specific combinations which contribute to all of those unique frequencies.
This is done by noticing that the generated frequencies can be written as
  \begin{equation}
    \omega_{[\sigma_m,n_m]} = \sum_{i=1}^m \sigma_i(\omega_0+n_i\Delta\omega)
  \end{equation}
where $\sigma_i=\pm1$ and $n_i\in[0,N]$. Frequencies $\omega_{[\sigma_m,n_m]}$ such that
  \begin{align}
    S_1 &= \sum_{i=1}^m \sigma_in_i \\
    S_2 &= \sum_{i=1}^m \sigma_i
  \end{align}
are identical will be the same. This makes it possible to construct of table of
terms that contribute to a given generated frequency $\omega_{[\sigma_m,n_m]}$
by iterating through all the possible values of $\sigma_i$ and $n_i$ and
classifying them according to their $S_1$ and $S_2$ values.

%\chapter{Other stuff to put in appendices}

\end{document}